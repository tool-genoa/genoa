# ================================================================================
#  GENOA v3.0: the GENerator of Optimized Atmospheric chemical mechanisms
#  Reference configuration file for GENOA v3.0
#
#  Notes:
#    - Comments must start with "#" or ";" (no inline comments).
#    - Use 1 to activate or 0 to deactivate an action or flag.
#    - The [action] section MUST exist for this configuration file to be valid.
#    - Updated variables will be printed on screen and/or in the log file.
#    - For user-defined variables and default values, see src/settings.py.
#    - Refer to example test cases in ./test_cases for usage patterns.
#
#  How to run:
#    1) cd <GENOA repo root>
#    2) python3 -m genoa <your_config_file.ini>
# ================================================================================


[action]

# Select which high-level actions GENOA should perform.
# 1 = enabled; 0 = disabled. Provide a corresponding section for each 1.
# Sections for actions set to 0 are ignored.

# Build mechanism (parse/convert and optionally clean/merge)
build_mechanism = 0

# Run simulations with the chosen box model
run_simulation  = 0

# Post-processing and plotting
post-processing = 0

# Threshold-based reduction
threshold_reduction = 0

# Simulation-based reduction (training)
training = 0

# Final evaluation of reduced mechanisms
testing = 0


[general]

# This section provides shared settings.

# Mechanism naming: final name is <prefix><id_mech>.
# Examples: prefix="U6", id_mech="O" -> "U6O"
id_mech = "O"
prefix  = "U6"

# Primary VOC precursors to include (list or single item).
# Species names must exist in the input mechanism.
primary_vocs = ["U06000"]

# Paths
# Input mechanism path. If empty or missing, falls back to path_sav_mech.
path_read_mech = "./test_cases/input/mech"
# Working directory for temporary files and intermediate outputs.
path_workplace = "./test_cases/output/work"
# Output directory for mechanisms.
path_sav_mech  = "./test_cases/output/mech"
# Output directory for simulation results.
path_sav_res   = "./test_cases/output/res"

# Files defining "basic" species. If absent from the input mechanism,
# they are added automatically and treated as non-reducible.
# Each file lists species and molecular weights.
basic_species_files = ["./data/gecko-files/basic_species.txt"]

# Reference results for error comparison (single path or comma-separated list).
# Ensure reference simulations used identical settings to avoid bias.
err_ref_str = "./test_cases/input/res/Results_U6O"

# File containing reference concentrations used for condition-dependent properties
# such as lifetimes. Typically points to a Results_* folder/file.
refconc_file = "./test_cases/input/res/Results_U6O"
# Whether to use "fake radical" concentrations from produced tracers as references.
# 1 = use fake radicals; 0 = use actual references from <refconc_file>
refconc_wfake = 0

# Tracer species to track sinks ("loss_tracers") and sources ("gain_tracers").
# Useful for evaluation under fixed oxidant profiles.
loss_tracers = {"HO":"YLHO", "O3":"YLO3", "NO2":"YLNO2", "HO2":"YLHO2", "NO3":"YLNO3", "NO":"YLNO"}
gain_tracers = {"NO2":"YPNO2", "HO2":"YPHO2", "NO3":"YPNO3", "O3":"YPO3", "HO":"YPHO", "NO":"YPNO"}

# CPU allocation. If omitted, GENOA uses all available logical CPUs.
ncpu = 1


[GECKO-A]

# Settings for the GECKO-A box model. Required if you will run GECKO-A simulations.

# Path to the GECKO-A model directory provided with GENOA.
path = "./vendor/boxmodel4gecko-v-1-0-genoa"

# Build command for your system architecture (run once before simulations).
# Replace "your_arch_file" with your architecture file.
cmd_build = "./build.sh --arch your_arch_file"

# Namelist file specifying GECKO-A simulation configuration.
# Modify as needed: e.g., relative humidity, temperature, ...
# Note: some parameters may be overridden by GENOA during simulations.
namelist  = "./test_cases/conditions/U6/simu.nml"

# Number of OpenMP threads per simulation. If omitted, omp_num = ncpu.
# This controls threading internal to GECKO-A (not the outer GENOA parallelism).
omp_num = 1


[build_mechanism]

# Required if build_mechanism = 1. Controls parsing and cleaning of mechanisms.

# Update mode for pruning and consistency checks:
#   "wsps"  = remove species not referenced by reactions (keeps basic species) - default.
#   "wpvoc" = keep basic reactions plus reactions derived from PVOCs; applies wsps.
#   "wgen"  = wpvoc plus update "generation depth" for reducible species.
update_mode = "wsps"

# Merge reactions that share identical reactants and kinetic parameters.
# May introduce small numerical differences owing to solver behavior.
if_merge = 0

# reactionfile: File (or folder for GECKO) containing reaction information.
# Support types: GECKO | GENOA | SSH | MCM | FACSMILE
reactionfile = "./test_cases/input/mech/U6T-0/U6T-0.reactions"
reactiontype = "SSH"
# speciesfile: File (or folder for GECKO) containing species information.
# Support types: GECKO | GENOA | SSH | MCM
speciesfile  = "./test_cases/input/mech/U6T-0/U6T-0.mol"
speciestype  = "SSH"

# Update species information from SMILES strings (1 = yes, 0 = no) - for GECKO only.
update_from_smiles = 0

# Add "fake radical" species to trace radical production during simulations.
# When enabled, a reaction like A -> <RO2> becomes A -> <RO2> + f<RO2>,
# where f<RO2> records the production of <RO2>.
# Reserved prefixes: "f" for GECKO-A; "FA" for SSH-aerosol.
# Set 1 to enable; 0 to disable.
# add_fake_radical = 0

# Non-volatile classification threshold (atm).
# Species with Psat < psat_nvoc are treated as NVOCs (non-volatile).
# Set to 0.0 to disable NVOC classification.
psat_nvoc = 0.0

# Semi-volatile classification threshold (atm).
# Species with Psat < psat_svoc are treated as SVOCs (semi-volatile).
# Set to 0 to disable SVOC classification.
psat_svoc = 1E-3


[run_simulation]

# Common simulation settings used by actions that run the box model.

# Choose box model:
#   "GECKO" = GECKO-A box model (v1.0),
#   "SSH"   = SSH-aerosol model (v2.0).
boxmodel = "GECKO"

# Result output mode:
#   GECKO-A: 2 = NetCDF + binary; 1 = binary only; 0 = GENOA files only
#   SSH    : 2 = NetCDF + text;   1 = text only;  0 = GENOA files only
# Higher values provide more detail but require more storage and time.
# Recommended during reduction: 0 for speed and lower disk usage.
result_mode = 2

# Directory containing initial-condition files (one file per condition).
path_init_cond = "./test_cases/conditions/U6/1conds"

# Simulation time settings
# Simulations are performed for all listed time settings, and outputs are saved 
# sequentially by index in the given order.
#
# Each time variable (<start_t>, <total_t>, <delta_t>, <dates>) can include 
# multiple values to run several configurations automatically.
# Simulations are run for all combinations of the provided values, saving results
# in T0, T1, T2, ... folders under <path_sav_res>.

# start_t: simulation start time in seconds.
start_t    = [0]
# total_t: total duration in seconds (e.g., 43200 = 12 h).
total_t    = [43200]
# delta_t: solver time step in seconds (e.g., 600 = 10 min).
delta_t    = [600]
# dates: list of simulation dates [year, month, day]
dates      = [[2015, 1, 1]]

# Additional species to track in time series, beyond total SOA.
# Use ";" to separate columns. Within a column, species separated by "," are summed.
# Time series are written to "outdat.genoa" in the specified order.
error_species_str = "GO3;GNO,GNO2"


[environment]

# Environmental conditions. Defaults also exist in src/setting_init.py (EnvOption).

# List of temperatures (K) used for reductions/evaluations.
temps = [298.0, 253.0, 273.0, 293.0, 313.0]

# List of pressures (molecules cm^-3).
press = [2.55e19]

# Relative humidity values (0â€“1).
rhs   = [0.70]

# Solar zenith angles in degrees.
azis  = [0.0, 45.0]

# Photolysis file used for reactions with keyword "PHOT" - need for simulations.
photolysis_file = "./data/gecko-files/solarlight.phot"


[threshold_reduction]

# Required if threshold_reduction = 1 (threshold-based reduction).

# Identifier appended to <prefix> when saving threshold-reduced mechanisms:
# saved to <path_sav_mech>/<prefix><runid>
runid = "tbr"

# Save all intermediate pre-reduced mechanisms after each attempt.
# Files are stored under <path_sav_mech>/pretrain_<runid>/<mech>-<ntry>-<code>.
# May require substantial storage.
tag_save_all = 0

# Run simulations of the final reduced mechanism and compare to references.
tag_sim = 0

# Number of attempts per strategy configuration.
ntry = 1

# Strategy thresholds for rule-based pruning (uncomment to activate and set values).
# The application order can be adjusted in src/reduction_setting.py (tbr_order).

# VOC reclassification: remove species with Psat > svoc (atm)
#svoc = 1E-5

# NVOC reclassification: remove species with Psat < nvoc (atm)
#nvoc_tree = 1E-10

# VOC branch removal: remove species branch if all Psat > svoc (atm)
#svoc_tree = 1E-5

# Absolute product yield removal: remove products with yield < pyield (one-step reactions)
#pyield = 0.01

# Node depth limit: remove species with generation > limit
#generation = 12

# Relative production yield removal: remove products with yield < pyield_tree (multi-step reactions)
#pyield_tree = 1E-8

# Reaction branching ratio removal: remove reactions with branching ratio < bratio
#bratio = 1E-4

# Branch concentration removal: remove species branch if all concs < conc_tree (ppb).
# No reduction on terminated species only.
#conc_tree = 1E-3

# Fast-degrading speciees jumping: skip species with lifetime < value (s)
#lifetime = 1


[training]

# Required if training = 1 (simulation-based reduction).
# See src/reduction_setting.py for details on lumping, jumping, and replacement.

# Trained mechanisms are saved to <path_sav_mech>/mechs_<runid>.
runid = "sbr"

# CSV containing multi-stage training parameters and options.
# Reference: ./test_case/config/parameter_reference.csv
# All CSV parameters can be overridden here but will apply uniformly to all stages.
training_parameter_table = "./test_cases/config/6_training_parameters.csv"

# Number of CPUs used to generate and evaluate reduction candidates in parallel.
# If omitted, all available CPUs are used.
npara = 1

# Time limit in seconds for a training run. Leave unset for no limit.
# Actual runtime may slightly exceed tlim to complete a cycle; account for overhead.
tlim = 600

# Restart from a previous checkpoint file or 0 to start fresh.
restart_from = 0

# When running GENOA on HPC systems, the parameters <tlim> and <restart_from> 
# allow the reduction to continue across multiple time blocks.
# - <tlim> sets a time limit (in seconds) for each training job.
# - When <restart_from> = 1, GENOA restarts automatically from the saved checkpoint
#   to continue the next time block.

# Reference mechanism for training (use [general] if not set here).
ref_mech_name = "U6O"
ref_mech_path = "./test_cases/input/mech"

# Starting-point mechanism for training.
# If both threshold_reduction and training are enabled, the starting mechanism
# is taken automatically from the threshold-reduction output.
mech_name = "U6O"
mech_path = "./test_cases/input/mech"

# Candidate grouping and ordering mode:
#   gen_prop     = similarity-based grouping (recommended for large GECKO-A mechanisms)
#   gen_delete   = rank species by removal influence (slower, more granular)
#   gen_delete_O = as gen_delete, but prioritize names ending with "O" (MCM RO species)
group_order_mode = "gen_prop"

# Optional file to provide custom grouping/ranking. Leave empty to use the mode above.
# group_order_file = ""

# Optional special-species lists.
# Primary VOCs (pvocs) are already reserved internally and do not need to be added here.
# List of gas-phase species to be excluded from reduction identification (kept fixed throughout).
#frozen_species = [""]
# List of species to retain in the reduced mechanism (modification is allowed, but not removal)
#kept_species = [""]

# Path to pretesting conditions used to evaluate the reduced mechanism at the end of each reduction cycle.
pretesting_path = "./test_cases/conditions/U6/2conds"

# End-of-cycle thresholds for average/maximum errors to terminate training.
#
# To improve or reattempt the reduction, users may adjust:
#   - training conditions (defined in the parameter CSV file),
#   - the list of error species (<error_species_str>),
#   - or the tolerance values (<stop_at_eave>, <stop_at_emax>).
stop_at_eave = 99.0
stop_at_emax = 99.0

# Merge reactions at the end of each reduction cycle as a cleanup step.
# Enabled by default (1).
# Disable (set 0) if the merged mechanism generates reaction lines that are 
# too long for the GECKO-A box model, which may prevent simulations.
with_merge = 1

# Remove temporary files created under <path_workplace>/training/<runid> 
# after completing reduction cycles.
clean_tmp = 1


[testing]

# Required if testing = 1 (mechanism evaluation).

# Identifier for saving testing outputs.
runid = "test"

# Name of the reference mechanism.
ref_mech_name = "U6O"
# Path to the reference mechanism.
ref_mech_path =  "./test_cases/input/mech"

# Folder that contains testing dataset.
path_cond = "./test_cases/conditions/U6/4conds"

# Optional: precomputed reference results to skip re-running references.
#read_ref = "./test_cases/work.testing/ref/res/U6O"


[post-processing]

# Required if post_processing = 1 (comparisons, plots, and exports).

# Name for post-processing outputs.
savpath = "./test_cases/output/post"

# Mechanism names to include in post-processing (order matters).
# If omitted, tools fall back to values from [general].
mech_names  = ["U6O", "U6R", "U6T-0", "U6T-1"]

# Labels aligned with mech_names (used in plots/legends). If omitted, uses mech_names.
mech_labels = ["org", "tbr", "sbr1", "sbr2"]

# Mechanism directories. Accepts a single string (applied to all) or a list aligned with mech_names.
mech_paths  = "./test_cases/input/mech"

# Result directories aligned with mech_names. If omitted, uses path_sav_res from [general].
mech_respaths = ["./test_cases/input/res/Results_U6O","./test_cases/input/res/Results_U6R","./test_cases/input/res/Results_U6T-0","./test_cases/input/res/Results_U6T-1"]


# === Reduction visualization ===

# Reduction records to visualize the reduction process.
# Format: [[record_file, start_mech_or_None, end_mech_or_None], ...]
plot_reduction = [["./test_cases/input/mech/record_T.txt", None, None]]


# === Pathway visualization ===

# Flowchart settings for targeted species.
# Format: [[species_list, "n_up,n_down", save_figs(1)/data_only(0)], ...]
plot_flowchart = [["U06000", "0,0", 1]]


# === Simulation result visualization ===

# Unit for plotting. Options: "ug" (ug/m3), "ppb", "molec" (molec/cm3), "ppbC".
# Outputs are saved under <savpath>_<unit>.
unit = "ppb"

# Flags
# Merge multi-condition plots into a merged/ subfolder.
tag_merge = 1
# Export plotted data as CSV files.
tag_csv   = 1
# Also generate normalized-data plots.
tag_wnorm = 0

# === Figure families (uncomment to enable) ===

# Time series (lines or stacked) by groups/phases.
#plot_time_series = ["rsp_gas", "rsp_aero", "O3_gas"]

# Stacked time series by volatility class and phase.
#plot_volatility = ["total", "gas", "aero"]

# Time series of OM/OC, O/C, H/C, N/C (default phase: total).
#plot_ratios = ["org_aero"]

# Stacked time series by functional groups.
#plot_functional_group = ["gas_GECKO", "aero_GECKO"]

# EKMA-style plot of HC/NOx ratio over user-defined phase intervals.
#plot_hc_nox_ratio = ["total"]

# Reactivity time plots for selected reactants (e.g., HO, O3, NO3, NO, HO2).
#plot_reactivity = ["HO,O3,NO3_rsp"]

# Carbon distribution (stacked/line) for total/gas/aero.
#plot_carbon = ["total"]

# === Comparison options ===

# Plot differences across mechanisms.
#plot_mech_cmp = "all"

# List of error types for comparison.
# Available options are defined in src/error_analysis.py (variable: ERR_TYPE_ALL)
#err_types = "all"

# Mechanism label used as reference for error calculations.
#err_ref_mech = "org"

