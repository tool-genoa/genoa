# ================================================================================
#  GENOA v3.0: the GENerator of Optimized Atmospheric chemical mechanisms
#  Configuration file for GENOA v3.0
#
#  Purpose:
#    Perform a seres of reductions and evaluations with one configuration file.
#    Reference mechanism: U6O --> threshold-based reduction -->
#      simulation-based reduction (training) (time limit: 600s) -->
#      final reduced mechanism evaluation (testing)
#
#  Note:
#    Running a full reduction can be time consuming.
#    Use nohup to run in background if needed.
#    Current training is set to 600s for demonstration purpose. You can comment
#      out <tlim> in [training] section to run without time limit.
#
# ================================================================================


[action]

# Threshold-based reduction
threshold_reduction = 1

# Simulation-based reduction
training = 1

# Final reduced mechanism evaluation
testing = 1

[general]

id_mech = "O"
prefix  = "U6"

# Primary precursors
primary_vocs = ["U06000"]

# Paths
# Read mechanism from path_read_mech (if not specified, use path_sav_mech)
path_read_mech = "./test_cases/input/mech"

path_workplace = "./test_cases/output/work"
path_sav_mech  = "./test_cases/output/mech"
path_sav_res   = "./test_cases/output/res"

# Basic species to include in the mechanism
basic_species_files = ["./data/gecko-files/basic_species.txt"]

# Reference results for error comparison (outdat.genoa)
err_ref_str = "./test_cases/input/res/Results_U6O"

# Reference concentrations for env-dependent thresholds (outdat.bof) 
refconc_file = "./test_cases/input/res/Results_U6O"

# Number of cpus used. If not specified, use all available cpus.
ncpu = 1

[GECKO-A]

# GECKO-A box model settings
# Important: Make sure you have built the model with <cmd_build>
#   before running simulations
path      = "./vendor/boxmodel4gecko-v-1-0-genoa"
# Replace "your_arch_file" with the actual architecture file for your system
# See GECKO-A box model documentation for details
cmd_build = "./build.sh --arch your_arch_file"
# GECKO-A namelist file - modify as needed
namelist  = "./test_cases/conditions/U6/simu.nml"

# Number of threads for OpenMP parallel
omp_num = 1

[run_simulation]

# Box model to run: GECKO | SSH
boxmodel = "GECKO"

# Result output options: 2: netcdf + binary 1 = binary, 0 = only genoa files
# Set 0 for faster simulations with less disk usage
result_mode = 0

# Initial conditions: one condition per file in folder
path_init_cond = "./test_cases/conditions/U6/1conds"

# Simulation time settings
# Start time, total time and time step in second
start_t    = [0]
total_t    = [43200]
delta_t    = [600]
# Simulation dates (year, month, day)
dates      = [[2015, 1, 1]]

# Error species besides the total SOA mass.
error_species_str = "GO3;GNO,GNO2"

[threshold_reduction]

# Threshold-reduced mechanism will be saved as [path_sav_mech]/[prefix][runid]. e.g., U6O -> U6r1
runid = "tbr"

# Run simulation with the reduced mechanism and compare errors with reference
tag_sim = 1

# Options for threshold-based reduction
# Uncomment to activate with specified thresholds

# VOC reclassification: remove species with Psat > svoc (atm)
svoc = 1E-5

# NVOC reclassification: remove species with Psat < nvoc (atm)
nvoc_tree = 1E-10

# VOC branch removal: remove species branch if all Psat > svoc (atm)
svoc_tree = 1E-5

# Absolute product yield removal: remove products with yield < pyield (one-step reactions)
pyield = 0.01

# Node depth limit: remove species with generation > limit
generation = 12

# Relative production yield removal: remove products with yield < pyield_tree (multi-step reactions)
pyield_tree = 1E-8

# Reaction branching ratio removal: remove reactions with branching ratio < bratio
bratio = 1E-4

# Branch concentration removal: remove species branch if all concs < conc_tree (ppb). No reduction on terminated species only.
conc_tree = 1E-3

# Fast-degrading speciees jumping: skip species with lifetime < value (s)
lifetime = 1

[training]

# Number of cpus for parallel computing. If not specified, use all available cpus.
npara = 1

# Time limit for training in seconds. If not specified, no time limit.
tlim = 600

# Reduced mechanisms will be saved in <path_sav_mech>/mechs_<runid>
runid = "sbr"

# File containing training parameters and options.
training_parameter_table = "./test_cases/config/6_training_parameters.csv"

# Reference mechanism
ref_mech_name = "U6O"
ref_mech_path = "./test_cases/input/mech"

# Grouping and ordering options: gen_prop | gen_delete
group_order_mode = "gen_prop"

# Reduction evaluation at the end of each cycle
pretesting_path = "./test_cases/conditions/U6/2conds"
# Thresholds for average/maximum errors to terminate training.
stop_at_eave = 0.5
stop_at_emax = 0.99

[testing]

# ID: identifier to save testing results
runid = "tst"

# Folder that contains testing dataset.
path_cond = "./test_cases/conditions/U6/4conds"
